function wpbs_htmlEscape(a){return String(a).replace(/&/g,"--AMP--").replace(/"/g,"--DOUBLEQUOTE--").replace(/'/g,"--QUOTE--").replace(/</g,"--LT--").replace(/>/g,"--GT--")}function wpbs_customReplace(a){return String(a).replace(/--AMP--/g,"&").replace(/--DOUBLEQUOTE--/g,'"').replace(/--QUOTE--/g,"'").replace(/--LT--/g,"<").replace(/--GT--/g,">")}function showLoader(){wpbs(".wpbs-loading").fadeTo(0,0).css("display","block").fadeTo(200,1),wpbs(".wpbs-calendar ul").animate({opacity:"0.7"},200)}function hideLoader(){wpbs(".wpbs-loading").css("display","none")}function wpbs_changeDay(a,s){var t={action:"wpbs_changeDayAdmin",calendarDirection:a,totalCalendars:$instance.find(".wpbs-total-calendars").html(),currentTimestamp:s,calendarData:$instance.find(".wpbs-calendar-data").attr("data-info"),calendarHistory:$instance.find(".wpbs-calendar-history").html(),calendarLegend:$instance.find(".wpbs-calendar-legend").attr("data-info"),showDropdown:$instance.find(".wpbs-show-dropdown").html(),autoPending:$instance.find(".wpbs-calendar-auto-pending").html(),weekNumbers:$instance.find(".wpbs-calendar-week-numbers").html(),calendarSelectionType:$instance.find(".wpbs-calendar-selection-type").html(),calendarLanguage:$instance.find(".wpbs-calendar-language").html(),weekStart:$instance.find(".wpbs-calendar-week-start").html(),calendarID:$instance.find(".wpbs-calendar-ID").html()};wpbs.ajax({type:"POST",url:wpbs_ajaxurl,contentType:"application/json; charset=utf-8",dataType:"html",data:JSON.stringify(t),success:function(a){$instance.find(".wpbs-calendars").html(a),hideLoader(),wpbs(".wpbs-chosen").chosen()}})}function wpbs_makeid(){for(var a="",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",t=0;t<5;t++)a+=s.charAt(Math.floor(Math.random()*s.length));return a}function wpbs_saveCalendar(a){if(1==$saveCalendarDisabled)return!1;var s={action:"wpbs_saveCalendar",users:wpbs('[name="wpbs-calendar-users[]"]').map(function(){return wpbs(this).val()}).get(),title:wpbs('[name="calendarTitle"]').val(),data:wpbs("#inputCalendarData").val(),id:wpbs('[name="calendarID"]').val()};wpbs.ajax({type:"POST",url:wpbs_ajaxurl,contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(s),success:function(a){wpbs("body").scrollTop(0),wpbs("#wpbs-notification-wrapper").append('<div id="wpbs-notice" class="notice notice-'+a.class+' is-dismissible"><p>'+a.msg+"</p></div>");setTimeout(function(){wpbs("#wpbs-notice").remove()},2e3);if(void 0!==a.url){$saveCalendarDisabled=!0,wpbs(".wpbs_saveCalendar").attr("disabled",!0);setTimeout(function(){window.location.href=""+a.url},2050)}else{setTimeout(function(){window.location.reload()},1500)}}})}function objectifyForm(a){for(var s={},t=0;t<a.length;t++)s[a[t].name]=a[t].value;return s}function wpbs_saveForm(){var a=function(a){var s=[];return wpbs(a+" input, "+a+" select, "+a+" textarea").each(function(a,t){field=wpbs(this),"autoreply_include_details"==field.attr("name")?s.push({input:field.attr("name"),value:field.prop("checked")}):s.push({input:field.attr("name"),value:field.val()})}),s};if(1==$saveFormDisabled)return!1;var s={id:wpbs('[name="formID"]').val(),title:wpbs('[name="formTitle"]').val(),fields:function(){var a;return wpbs("#wpbs-form-json").length>0&&(a=wpbs("#wpbs-form-json").val()),a}(),translations:a(".translations"),formSettings:a(".form-settings"),autoreply:a(".auto-reply"),emailSettings:a(".email-settings")},t={action:"wpbs_saveForm",data:s};wpbs.ajax({type:"POST",url:wpbs_ajaxurl,contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(t),success:function(a){if(wpbs("body").scrollTop(0),wpbs("#wpbs-notification-wrapper").append('<div id="wpbs-notice" class="notice notice-'+a.class+' is-dismissible"><p>'+a.msg+"</p></div>"),0==a.result)return!1;setTimeout(function(){wpbs("#wpbs-notice").remove()},3e3);if(void 0!==a.url){$saveFormDisabled=!0,wpbs(".wpbs_saveForm").attr("disabled",!0);setTimeout(function(){window.location.href=""+a.url},3350)}else{setTimeout(function(){window.location.reload()},1500)}}})}function wpbs_bookingAction(){var a=wpbs("#bookingInfo"),s=wpbs(".wpbs-bookings-tabs"),t={action:"wpbs_bookingAction",bookingAction:a.attr("data-booking-action"),bookingId:a.attr("data-booking-id"),calendarId:a.attr("data-calendar-id"),from:a.attr("data-booking-from"),dates:JSON.stringify(wpbs("#wpbs_ModalDatesEditor").serializeArray()),statuses:{pending:s.find("#status-pending").html().replace(/"/g,"").replace(/'/g,"").replace(/\(|\)/g,""),accepted:s.find("#status-accepted").html().replace(/"/g,"").replace(/'/g,"").replace(/\(|\)/g,""),trash:s.find("#status-trash").html().replace(/"/g,"").replace(/'/g,"").replace(/\(|\)/g,"")},send_confirmation:wpbs(".send-confirmation-message").val(),confirmation_message:wpbs(".send-confirmation-message-additional").val()};wpbs.ajax({type:"POST",url:wpbs_ajaxurl,contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(t),success:function(a){if(wpbs_random_id=wpbs_makeid(),a.status){wpbs("body").scrollTop(0),wpbs("#wpbs-notification-wrapper").append('<div id="'+wpbs_random_id+'" class="notice notice-'+a.class+' is-dismissible"><p>'+a.msg+"</p></div>"),wpbs("#wpbs-booking-field-"+a.id).removeClass("wpbs-booking-selected wpbs-booking-move wpbs-booking-delete").addClass(a.action_class),wpbs("#status-pending").html(a.statuses.pending),wpbs("#status-accepted").html(a.statuses.accepted),wpbs("#status-trash").html(a.statuses.trash);setTimeout(function(){wpbs("#wpbs-booking-field-"+a.id).closest("tr").remove(),wpbs("#"+wpbs_random_id).remove()},1e3);wpbs_saveCalendar(!0)}else wpbs("#wpbs-notification-wrapper").append('<div id="'+wpbs_random_id+'" class="notice notice-error is-dismissible"><p>Something went wrong</p></div>');setTimeout(function(){wpbs("#"+wpbs_random_id).remove()},1e3)}})}function wpbs_select_text(a){if(document.selection){var s=document.body.createTextRange();s.moveToElementText(a),s.select()}else if(window.getSelection){var s=document.createRange();s.selectNode(a),window.getSelection().addRange(s)}}var wpbs=jQuery.noConflict(),$instance,$saveCalendarDisabled=!1,$saveFormDisabled=!1;String.prototype.stripSlashes=function(){return this.replace(/\\(.)/gm,"$1")},wpbs(document).ready(function(){wpbs(".wpbs-chosen").chosen(),wpbs(".wpbs-wrap .meta-box-sortables").sortable({disabled:!0}),wpbs(".wpbs_saveCalendar").each(function(){wpbs(this).on("click",function(){wpbs_saveCalendar()})}),wpbs(".wpbs_saveForm").each(function(){wpbs(this).on("click",function(){wpbs_saveForm()})}),wpbs("#wpbs_bookingAction").each(function(){wpbs(this).on("click",function(){wpbs_bookingAction()})}),wpbs(".wpbs-container").each(function(){$instance=wpbs(this),wpbs($instance).on("change",".wpbs-dropdown",function(a){showLoader(),a.preventDefault(),wpbs_changeDay("jump",wpbs(this).val())}),wpbs($instance).on("click",".wpbs-prev",function(a){showLoader(),a.preventDefault(),0==$instance.find(".wpbs-current-timestamp a").length?timestamp=$instance.find(".wpbs-current-timestamp").html():timestamp=$instance.find(".wpbs-current-timestamp a").html(),wpbs_changeDay("prev",timestamp)}),wpbs($instance).on("click",".wpbs-next",function(a){showLoader(),a.preventDefault(),0==$instance.find(".wpbs-current-timestamp a").length?timestamp=$instance.find(".wpbs-current-timestamp").html():timestamp=$instance.find(".wpbs-current-timestamp a").html(),wpbs_changeDay("next",timestamp)})}),wpbs(document).on("click","#calendarBatchUpdate",function(a){a.preventDefault();var s=wpbs(".wpbs-calendar-data").attr("data-info");s=s?JSON.parse(s):{};var t=wpbs(".wpbs-current-timestamp").html(),e=new Date(1e3*t),n=wpbs("#startDay").val(),p=wpbs("#startMonth").val(),o=wpbs("#startYear").val(),l=wpbs("#endDay").val(),r=wpbs("#endMonth").val(),d=wpbs("#endYear").val(),b=wpbs("#changeStatus").val(),c=wpbs("#bookingDetails").val(),w=Date.parse(n+" "+p+" "+o)/1e3,m=Date.parse(l+" "+r+" "+d)/1e3;if(w<m)for(i=w;i<=m+82800;i+=86400){var u=new Date(1e3*i);u.getMonth()==e.getMonth()&&u.getFullYear()==e.getFullYear()&&(wpbs("select.wpbs-day-"+u.getDate()).find("option.wpbs-option-"+b).prop("selected")||(wpbs("select.wpbs-day-"+u.getDate()).find("option").prop("selected",!1),wpbs("select.wpbs-day-"+u.getDate()).find("option.wpbs-option-"+b).prop("selected",!0)),wpbs("select.wpbs-day-"+u.getDate()).parents("li").find("span.wpbs-select-status").removeClass().addClass("wpbs-select-status status-"+b),wpbs("select.wpbs-day-"+u.getDate()).parents("li").find("span.wpbs-day-split-top").removeClass().addClass("wpbs-day-split-top wpbs-day-split-top-"+b),wpbs("select.wpbs-day-"+u.getDate()).parents("li").find("span.wpbs-day-split-bottom").removeClass().addClass("wpbs-day-split-bottom wpbs-day-split-bottom-"+b),wpbs("select.wpbs-day-"+u.getDate()).parents("li").find(".wpbs-input-description").val(c),wpbs(".wpbs-calendars li.wpbs-day-"+u.getDate()).removeClass().addClass("wpbs-day wpbs-day-"+u.getDate()+" status-"+b),wpbs(".wpbs-calendars li.wpbs-day-"+u.getDate()+" span.wpbs-day-split-top").removeClass().addClass("wpbs-day-split-top wpbs-day-split-top-"+b),wpbs(".wpbs-calendars li.wpbs-day-"+u.getDate()+" span.wpbs-day-split-bottom").removeClass().addClass("wpbs-day-split-bottom wpbs-day-split-bottom-"+b));var f="year"+u.getFullYear(),g="month"+(u.getMonth()+1),h="day"+u.getDate(),t=wpbs(".wpbs-current-timestamp").html(),e=new Date(1e3*t),g=u.getMonth()+1,f=u.getFullYear(),h=u.getDate();f in s||(s[f]={}),g in s[f]||(s[f][g]={}),s[f][g][h]=b,s[f][g]["description-"+h]=c,wpbs("span.error").css("display","none")}else wpbs("span.error").css("display","block");wpbs(".wpbs-calendar-data").attr("data-info",JSON.stringify(s)),wpbs("#inputCalendarData").val(JSON.stringify(s))}),wpbs(document).on("change",".wpbs-day-select",function(a){var s=wpbs_customReplace(wpbs(".wpbs-calendar-data").attr("data-info"));s=s?JSON.parse(s):{};var t=wpbs(".wpbs-current-timestamp").html(),e=(new Date(1e3*t),wpbs(this).attr("data-month").replace("wpbs-month-","")),n=wpbs(this).attr("data-year").replace("wpbs-year-",""),p=wpbs(this).attr("data-name").replace("wpbs-day-",""),i=wpbs(this).val();n in s||(s[n]={}),e in s[n]||(s[n][e]={}),s[n][e][p]=i,wpbs(this).parent().find("span.wpbs-select-status").removeClass().addClass("wpbs-select-status status-"+i),wpbs(this).parent().find("span.wpbs-day-split-top").removeClass().addClass("wpbs-day-split-top wpbs-day-split-top-"+i),wpbs(this).parent().find("span.wpbs-day-split-bottom").removeClass().addClass("wpbs-day-split-bottom wpbs-day-split-bottom-"+i),0==wpbs(this).parents(".wpbs-modal-box").length&&(wpbs(".wpbs-calendar li.wpbs-day-"+p).removeClass().addClass("wpbs-day wpbs-day-"+p+" status-"+i),wpbs(".wpbs-calendar li.wpbs-day-"+p+" span.wpbs-day-split-top").removeClass().addClass("wpbs-day-split-top wpbs-day-split-top-"+i),wpbs(".wpbs-calendar li.wpbs-day-"+p+" span.wpbs-day-split-bottom").removeClass().addClass("wpbs-day-split-bottom wpbs-day-split-bottom-"+i)),wpbs(".wpbs-calendar-data").attr("data-info",JSON.stringify(s)),wpbs("#inputCalendarData").val(JSON.stringify(s))}),wpbs(document).on("keyup",".wpbs-input-description",function(a){var s=wpbs(".wpbs-calendar-data").attr("data-info");s?(s=wpbs_customReplace(s.stripSlashes()),s=JSON.parse(s)):s={};var t=wpbs(".wpbs-current-timestamp").html(),e=(new Date(1e3*t),wpbs(this).attr("data-month").replace("wpbs-month-","")),n=wpbs(this).attr("data-year").replace("wpbs-year-",""),p=wpbs(this).attr("data-name").replace("wpbs-day-",""),i=wpbs(this).val();n in s||(s[n]={}),e in s[n]||(s[n][e]={}),s[n][e]["description-"+p]=wpbs_htmlEscape(i),wpbs(".wpbs-calendar-data").attr("data-info",JSON.stringify(s)),wpbs("#inputCalendarData").val(JSON.stringify(s))}),wpbs(".saveCalendar").click(function(){return!!wpbs.trim(wpbs(".fullTitle").val()).length||(wpbs(".fullTitle").addClass("error").focus(),!1)}),wpbs(document).on("click",".bulk-edit-legend-apply",function(){wpbs(".edit-dates-popup select").each(function(){wpbs(this).val(wpbs(".bulk-edit-legend-select").val()).trigger("change")}),wpbs(".edit-dates-popup input").each(function(){wpbs(this).val(wpbs(".bulk-edit-legend-text").val()).trigger("keyup")})})});